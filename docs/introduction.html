

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data-processing &mdash; Datapunt processing 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Datapunt processing 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="Modules" href="modules.html"/>
        <link rel="prev" title="Datapunt Processing" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Datapunt processing
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="#how-to-use">How to use</a></li>
<li class="toctree-l1"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="#notebooks">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="#how-to-contribute">How to Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prequisites">0. Prequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-function">1. Add function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-tests">2. Add tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-documentation">3. Add documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-pull-request">4. Add a Pull Request</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Datapunt processing</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Data-processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/introduction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-processing">
<span id="introduction"></span><h1>Data-processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://www.python.org/"><img alt="https://img.shields.io/badge/python-3.6-blue.svg" src="https://img.shields.io/badge/python-3.6-blue.svg" /></a>
<a class="reference external image-reference" href="https://www.mozilla.org/en-US/MPL/2.0/"><img alt="https://img.shields.io/badge/license-MPLv2.0-blue.svg" src="https://img.shields.io/badge/license-MPLv2.0-blue.svg" /></a>
<p>At the City of Amsterdam we deal with many different types of structured and unstructered data. Much of the data is not of high quality and are missing proper semantics to do proper analytics with.</p>
<p>This repository combines generic command line functions to create extract, transform and load steps we can then use for creating a reproducable data for analytics and usage in dashboards and maps.</p>
<p>For more information about the how we use these functions in our workflow, read the
<a class="reference external" href="https://amsterdam.github.io/guides/data-pipeline/">data-pipeline guide</a>.</p>
</div>
<div class="section" id="how-to-use">
<h1>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h1>
<p>Full documentation can be found here:
<a class="reference external" href="https://amsterdam.github.io/data-processing/">amsterdam.github.io/data-processing</a></p>
<p>Quickstart:
To use a function in python you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datapunt_processing.extract</span> <span class="k">import</span> <span class="n">download_from_catalog</span>

<span class="ow">or</span>

<span class="kn">from</span> <span class="nn">datapunt_processing.helpers.connections</span> <span class="k">import</span> <span class="n">objectstore_connection</span>
</pre></div>
</div>
<p>To use the functions directly from the command line in your virtual environment or docker shell you can use it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">download_from_data_amsterdam</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>To see the list of command line functions see the modules below or directly in <a class="reference external" href="https://github.com/Amsterdam/data-processing/blob/master/setup.py#L60">setup.py</a></p>
</div>
<div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>To get the functions up and running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install datapunt-processing
</pre></div>
</div>
<p>To develop the functions locally use these steps:</p>
<ol class="arabic simple">
<li>Clone the repository:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/Amsterdam/data-processing.git
<span class="nb">cd</span> data-processing
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Create Virtual environment in Windows</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and activate a virtual environment, for example with:</span>
python -m venv --copies --prompt data-processing .venv
.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Create Virtual environment in OSX</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>virtualenv --python<span class="o">=</span><span class="k">$(</span>which python3<span class="k">)</span> venv
<span class="nb">source</span> venv/bin/activate
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Install the data-processing modules in editable mode</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .
</pre></div>
</div>
<p>4. A database is required for the transform and load functions.
You can setup your postgres database credentials in the config.ini file to apply to the functions.</p>
<p>If want to use <a class="reference external" href="https://www.docker.com">Docker</a>, you can start a database server for your project in a new terminal. The name, port and login of the database can be changed in the docker-compose.yml. Also change them in the config.ini file which will be used by the functions to connect to that database.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose up -d database
</pre></div>
</div>
</div>
<div class="section" id="notebooks">
<h1>Notebooks<a class="headerlink" href="#notebooks" title="Permalink to this headline">¶</a></h1>
<p>Some of the examples are in the form of runnable Jupyter notebooks. Copies of these with all the images and output included are hosted at Anaconda Cloud. To run these notebooks on your own system, start up a Jupyter notebook server:</p>
<p>To install jupyter:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .<span class="se">\[</span>dev<span class="se">\]</span>

jupyter notebook --NotebookApp.iopub_data_rate_limit<span class="o">=</span><span class="m">100000000</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-contribute">
<h1>How to Contribute<a class="headerlink" href="#how-to-contribute" title="Permalink to this headline">¶</a></h1>
<p>If you want to contribute please follow the <a class="reference external" href="https://amsterdam.github.io/CONTRIBUTING/">contribute guidelines</a></p>
<div class="section" id="prequisites">
<h2>0. Prequisites<a class="headerlink" href="#prequisites" title="Permalink to this headline">¶</a></h2>
<p>Fork this repository to your local github account to add add and test new functions.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/Amsterdam/data-processing.git
</pre></div>
</div>
<p>Install the docs,test,dev packages using this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .<span class="o">[</span>docs,test,dev<span class="o">]</span>
or when using zsh
pip install -e .<span class="se">\[</span>docs,test,dev<span class="se">\]</span>
</pre></div>
</div>
<p>This package is build by using <a class="reference external" href="http://setuptools.readthedocs.io">setuptools</a> to be able to release stable versions on PyPi. It follows some of <a class="reference external" href="http://alexanderwaldin.github.io/packaging-python-project.html">these</a> guidelines of setting up a python package.</p>
</div>
<div class="section" id="add-function">
<h2>1. Add function<a class="headerlink" href="#add-function" title="Permalink to this headline">¶</a></h2>
<p>We try to use command line functions as much as possible to ensure we create functions to work easily with different environments and to force yourself creating more generic functions with input variables.</p>
<p>If possible, convert your function into a <a class="reference external" href="https://python-packaging.readthedocs.io/en/latest/command-line-scripts.html">python-package command line script</a> using the <a class="reference external" href="https://github.com/Amsterdam/data-processing/blob/master/src/boilerplate_function.py">boilerplate_function.py</a></p>
<dl class="docutils">
<dt>Add your function to the appropriate <a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/src/datapunt_processing">folder</a>:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/src/datapunt_processing/extract">extract</a></li>
<li><a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/src/datapunt_processing/transform">transform</a></li>
<li><a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/src/datapunt_processing/load">load</a></li>
<li><a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/src/datapunt_processing/helpers">helpers</a></li>
</ul>
</dd>
</dl>
<p>side note: not all functions are suitable for CL. Machine learning preprocessing steps or general API calls for instance, (that often require parameters in the form of dicts or lists) as input are not suitable and can be used as stand-alone scripts.</p>
</div>
<div class="section" id="add-tests">
<h2>2. Add tests<a class="headerlink" href="#add-tests" title="Permalink to this headline">¶</a></h2>
<p>Add test to the <a class="reference external" href="https://github.com/Amsterdam/data-processing/tree/master/tests">test folder</a> and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py <span class="nb">test</span>
</pre></div>
</div>
<p>to test if no other functions are breaking. Correct those issues as well if needed.</p>
</div>
<div class="section" id="add-documentation">
<h2>3. Add documentation<a class="headerlink" href="#add-documentation" title="Permalink to this headline">¶</a></h2>
<p>Create a awesome_module.rst file with <a class="reference external" href="http://sphinx-argparse.readthedocs.io/en/latest/">Sphinx Argparse extension</a> fields to generate the description and argument fields by reusing an <a class="reference external" href="https://github.com/Amsterdam/data-processing/blob/master/sphinx/source/extract/download_from_data_amsterdam.rst">existing rst file</a>. The helpers docs will generate automatically, so you can skip this step if it is placed in the helper function.</p>
<p>Add the rst filename to the list in <a class="reference external" href="https://github.com/Amsterdam/data-processing/blob/master/sphinx/source/modules.rst">modules.rst</a> to be found on the main page.</p>
<p>Regenerate the documentation to test the docs output using this command line function:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sphinx/make docs
and <span class="nb">test</span> <span class="k">if</span> the readme is not broken:
open docs/index.html
</pre></div>
</div>
</div>
<div class="section" id="add-a-pull-request">
<h2>4. Add a Pull Request<a class="headerlink" href="#add-a-pull-request" title="Permalink to this headline">¶</a></h2>
<p>Make a PR to add the add your awesome function to our processing code to be reused by many other developpers and data analists.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Datapunt Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Gemeente Amsterdam.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>